<div class="max-w-3xl mx-auto bg-white shadow-md rounded-xl p-6 mt-8 border">
  <h2 class="text-2xl font-bold text-indigo-700 mb-4">{{product.title}}</h2>
  <p class="text-gray-600 mb-3">{{product.description}}</p>

  <div class="mb-4">
    <p class="text-lg text-gray-800 font-semibold">
      ğŸ’² Precio: ${{product.price}}
    </p>
    <p class="text-sm text-gray-600">ğŸ·ï¸ CategorÃ­a: {{product.category}}</p>
    <p class="text-sm text-gray-600">ğŸ“¦ Stock disponible: {{product.stock}}</p>
  </div>

  <button
    onclick="addToCart('{{product._id}}')"
    class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700"
  >
    ğŸ›’ Agregar al carrito
  </button>

  <div class="mt-6 text-center">
    <a
      href="/products"
      class="text-indigo-600 hover:underline text-sm"
    >
      â¬…ï¸ Volver al catÃ¡logo
    </a>
  </div>
</div>

<script>
  async function addToCart(productId) {
    try {
      let cartId = localStorage.getItem('cartId');

      // ğŸ†• Si no hay carrito, crear uno
      if (!cartId) {
        const createResponse = await fetch('/api/carts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
        });

        if (!createResponse.ok) {
          alert('âŒ No se pudo crear el carrito.');
          return;
        }

        const createData = await createResponse.json();
        cartId = createData?.payload?._id;
        if (!cartId) {
          alert('âŒ El servidor no devolviÃ³ un ID de carrito vÃ¡lido.');
          return;
        }
        localStorage.setItem('cartId', cartId);
      }

      // â• Agregar producto al carrito (NO parseamos JSON acÃ¡)
      const addResponse = await fetch(`/api/carts/${cartId}/products/${productId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ quantity: 1 }),
      });

      if (addResponse.ok) {
        alert('âœ… Producto agregado al carrito correctamente.');
      } else {
        alert('âŒ El servidor no pudo agregar el producto al carrito.');
      }
    } catch (error) {
      console.error('âŒ Error al agregar al carrito:', error);
      alert('âŒ OcurriÃ³ un error al agregar el producto al carrito.');
    }
  }
</script>
